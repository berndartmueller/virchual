!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Virchual=s()}(this,(function(){"use strict";function t(t){t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())}class s{constructor(){this.t=[]}s(t,s,i,h={}){if("string"==typeof t)t.split(" ").forEach(t=>this.i(t,i,s,h));else for(const i in t)this.i(i,s,t[i],h)}h(t,s){if("string"==typeof t)t.split(" ").forEach(t=>this.o(t,s));else for(const i in t)this.o(i,s)}l(t,...s){this.t.forEach(i=>{i.u||i.event.split(".")[0]!==t||i.v(...s)})}m(){this.t.forEach(this.g),this.t=[]}g(t){t.u&&t.u.removeEventListener(t.event,t.v,t.p)}i(t,s,i,h){s&&s.addEventListener(t,i,h),this.t.push({event:t,v:i,u:s,p:h})}o(t,s){this.t=this.t.filter(i=>!i||i.event!==t||i.u!==s||(this.g(i),!1))}}class i{constructor(t,s){this.imports=t,this._=s,this.controls=[].slice.call(t.A.M.querySelectorAll(".virchual__control")),t.T.s("destroy",()=>{}),this.B=this.k.bind(this),this.mount()}mount(){this.controls.forEach(t=>this.imports.T.s("click",this.B,t))}k(s){t(s),"prev"!==s.target.closest("button").dataset.controls?this.imports.A.next():this.imports.A.prev()}}function h(t,{I:s,S:i}){const h=document.createElement(t);return h.className=s,h.innerHTML=i||"",h}function e(t){t&&t.parentElement&&t.parentElement.removeChild(t)}function n(t,s){t&&t.appendChild(s)}function o(t,s){t&&t.firstChild&&s&&t.insertBefore(s,t.firstChild)}function r(t,s,i=!1){i?t.classList.remove(s):t.classList.add(s)}function a(t,s=100){let i;return(...h)=>{clearTimeout(i),i=setTimeout(()=>requestAnimationFrame(()=>{i=null,t(...h)}),s)}}function c(t,s){return Array(s-t+1).fill(0).map((s,i)=>t+i)}function l(t,s){return t>s?0:t<0?s:t}const u=()=>{};function d(t,s,i){return[...c(s-i,s-1).map(s=>v(t,s)),t[s],...c(s+1,s+i).map(s=>v(t,s))]}function v(t,s){if(0===t.length)return;const i=s<0,h=s>t.length-1,e=i||h,n=h?-1:1,o=Math.max(Math.floor(Math.abs(s)/t.length),1);return e&&(s+=n*o*t.length),t[s]}function f(t){return t&&"picture"===t.nodeName.toLowerCase()}function m(t){const s=t.parentNode;return f(s)?s:t}class g{constructor(t,s){this.imports=t;const{$:i,D:h}=Object.assign({$:!0,D:"img,picture"},s);this.$=i,this.D=h,this.L={load:this.N.bind(this),error:this.j.bind(this)},this.$&&t.T.s({C:()=>{this.O()},move:()=>{this.O()}})}O(){this.X().forEach(t=>this.q(t))}X(){const t=d(c(0,this.imports.A.slides.length-1),this.imports.A.F,1),s=[];return t.forEach(t=>{const i=this.imports.A.slides[t];i.P&&[].forEach.call(i.U.querySelectorAll(this.D),t=>{f(t.parentElement)||s.push(t)})}),s}q(t){let s=!1;[].forEach.call(t.querySelectorAll("img,source"),t=>{const i=t.dataset.srcset,h=t.dataset.src;i&&(t.setAttribute("srcset",i),t.removeAttribute("data-srcset")),h&&(t.setAttribute("src",t.dataset.src),t.removeAttribute("data-src"),this.imports.T.s(this.L,t)),(i||h)&&(s=!0)}),s&&(t.classList.add("virchual__lazy"),t.classList.add("virchual__lazy--loading"))}N(t){const s=t.target;this.V(s)}j(t){const s=t.target;m(s).classList.add("virchual__lazy--failed"),this.V(s)}V(t){const s=m(t);s.classList.remove("virchual__lazy--loading"),s.classList.add("virchual__lazy--loaded"),this.imports.T.h(this.L,t)}}class p{constructor(t,{event:s}){this.frame=t,this.Y=!1,this.T=s,this.G={H:this.H.bind(this),J:a(this.J.bind(this),1),K:this.K.bind(this)}}mount(){this.T.s("touchstart mousedown",this.G.H,this.frame),this.T.s("touchmove mousemove",this.G.J,this.frame,{passive:!1}),this.T.s("touchend touchcancel mouseleave mouseup dragend",this.G.K,this.frame)}H(s){t(s),this.Y||(this.R=this.W(s,{}),this.Z=this.R,this.T.l("dragstart",this.Z))}J(s){t(s),this.R&&(this.Z=this.W(s,this.R),this.Y?(t(s),this.T.l("drag",this.Z)):this.tt(this.Z)&&(this.T.l("drag",this.Z),this.Y=!0))}tt({offset:t}){return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<45}K(){this.R=null,this.Y&&(this.st(this.Z),this.Y=!1)}st(t){const s=t.it.x;Math.abs(s)>0&&this.T.l("dragend",this.Z)}W(t,s){const{timeStamp:i,touches:h}=t,{clientX:e,clientY:n}=h?h[0]:t,{x:o=e,y:r=n}=s.ht||{},a={x:e-o,y:n-r},c=i-(s.time||0),l={x:a.x/c,y:a.y/c};return{offset:a,it:l,ht:{x:e,y:n},time:i,control:l.x<0?"next":"prev"}}}function y(t,s,i,h){return 0===t?t!==s:!(t!==i-1)&&s+1<h}function _(t,s,i){return s-i+t}class x{constructor(t,s,{et:i,nt:h}={}){this.M=t,this.ot=s,this.F=0,this.U=t.querySelector(".virchual__pagination"),this.rt=Math.min(s,null!=h?h:5),this.et=null!=i?i:16,this.at=Math.floor(this.rt/2)}ct(){this.U=h("div",{I:"virchual__pagination"}),this.U.style.width=this.rt*this.et+"px",this.U.style.height=this.et+"px",c(0,Math.min(this.rt,this.ot)-1).forEach(t=>{const s=y(t,t,this.rt,this.ot),i=this.lt(t,{ut:s,dt:t===this.F});n(this.U,i)}),n(this.M,this.U)}next(){this.st(1)}prev(){this.st(-1)}st(t){this.F=l(this.F+t,this.ot-1);const s=(i=this.F,h=this.at,e=this.ot,i-Math.max(i-h,0)+Math.max(i-(-1+e-h),0));var i,h,e;const n=s===this.at&&this.F>this.at,o=n?1===t?0:this.rt-1:-1;if([].slice.call(this.U.querySelectorAll("span")).forEach((i,h)=>{this.vt({ft:i,index:h,sign:t,gt:n,pt:o,yt:s})}),n){const i=-1+this.rt-o,h=y(i,_(i,this.F,s),this.rt,this.ot),e=this.lt(i,{ut:h});this._t(t,e)}}vt({ft:t,index:s,yt:i,sign:h,gt:n,pt:o}){if(o===s)return e(t);const r=y(s-=n?h:0,_(s,this.F,i),this.rt,this.ot);this.xt(t,{ut:r,dt:s===i,position:n?s*this.et:void 0})}lt(t,{dt:s,ut:i}={}){const e=h("span",{I:"virchual__pagination-bullet"});return this.xt(e,{dt:s,ut:i,position:t*this.et}),e}xt(t,{dt:s,ut:i,position:h}){r(t,"virchual__pagination-bullet--active",!s),r(t,"virchual__pagination-bullet--edge",!i),null!=h&&(t.style.transform=`translateX(${h}px)`)}_t(t,s){(1===t?n:o)(this.U,s)}}class M{constructor(t,s,i){this.frame=s,this._=i,this.P=!1,this.dt=!1,this.Mt=!1,"string"!=typeof t?(this.U=t,this.S=this.U.innerHTML,this.P=!0):this.S=t}set(t,s){this[t]=s,this.Mt=!0}ct(){const t=h("div",{I:"virchual__slide",S:this.S});return this.xt(t),t}mount(t=!1){this.P?this.Mt&&this.update():(this.U=this.ct(),this.P=!0,this.U.addEventListener("transitionend",this.bt),(t?o:n)(this.frame,this.U))}unmount(){this.P=!1,e(this.U)}translate(t,{easing:s,done:i}={}){this.bt=i||u,this.U.style.transition=`transform ${this._.speed}ms ${s?this._.easing:"ease"}`,this.U.style.transform=`translate3d(calc(${this.position}% + ${Math.round(t)}px), 0, 0)`}update(){this.Mt=!1,this.xt(this.U)}xt(t){r(t,"virchual__slide--active",!this.dt),t.style.transform=`translate3d(${this.position}%, 0, 0)`}}return class extends class{constructor(t,i={}){let h;this.M=t,this._=i,this.F=0,this.slides=[],this.Et=!1,this.frame=this.M.querySelector(".virchual__frame"),function(t){if(!t)throw new Error("Invalid element")}(this.frame),this.F=0,this._=Object.assign({slides:[],speed:200,wt:150,zt:.6,At:600,easing:"ease-out",Tt:!0,window:1},i),this.T=new s,this.G={k:this.k.bind(this),Bt:this.Bt.bind(this),kt:this.kt.bind(this)};const e=this._.slides;h="function"==typeof e?e():e,this.slides=this.It(),this.slides=this.slides.concat((h||[]).map(t=>new M(t,this.frame,this._))),this.Tt=new x(this.M,this.slides.length),this.Tt.ct()}register(t,s){new t({A:this,T:this.T},s)}mount(){this.St(),this.$t(),new p(this.frame,{event:this.T}).mount(),this.T.l("mounted")}disable(){}enable(){}s(t,s){this.T.s(t,s)}h(t){this.T.h(t)}prev(){this.st("prev")}next(){this.st("next")}m(){this.T.m(),this.T.l("destroy")}st(t){this.slides[this.F].translate(-100,{easing:!0,done:()=>{this.Et=!1}});const s="prev"===t?-1:1;this.F=l(this.F+1*s,this.slides.length-1),this.St({control:t}),("prev"===t?this.Tt.prev.bind(this.Tt):this.Tt.next.bind(this.Tt))(),this.T.l("move",{index:this.F,control:t})}It(){return[].slice.call(this.frame.querySelectorAll("div")).map(t=>new M(t,this.frame,this._))}St({control:t}={}){const s=this.slides[this.F],i=c(0,this.slides.length-1),h=this._.window,e=d(i,this.F,h);d(i,this.F,h+1).forEach(i=>{const n=this.slides[i];i===this.F?s.set("isActive",!0):s.set("isActive",!1);const o=e.indexOf(i);if(o<0)return n.unmount();n.set("position",-100*(h-o));const r="prev"===t||null==t&&this.slides[0].P&&o-h<0;n.mount(r)})}$t(){this.T.s("drag",this.G.Bt),this.T.s("dragend",this.G.kt),this.T.s("click",this.G.k,this.frame,{capture:!0})}k(s){this.Et&&t(s)}Bt(t){this.Et=!0;const s=d(c(0,this.slides.length-1),this.F,this._.window),i="prev"===t.control?1:-1;s.forEach(s=>{const h=this.slides[s],e=i*Math.abs(t.offset.x);h.translate(e)})}kt(t){this.st(t.control)}}{constructor(t,s={}){super(t,s),this.register(i,{isEnabled:!0}),this.register(g,{$:!0})}}}));
//# sourceMappingURL=virchual.bundle.min.js.map
