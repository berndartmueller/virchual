!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Virchual=s()}(this,(function(){"use strict";function t(t){t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())}class s{constructor(){this.t=[]}s(t,s,i,h={}){if("string"==typeof t)t.split(" ").forEach(t=>this.i(t,i,s,h));else for(const i in t)this.i(i,s,t[i],h)}h(t,s){if("string"==typeof t)t.split(" ").forEach(t=>this.o(t,s));else for(const i in t)this.o(i,s)}l(t,...s){this.t.forEach(i=>{i.u||i.event.split(".")[0]!==t||i.v(...s)})}destroy(){this.t.forEach(this.m),this.t=[]}m(t){t.u&&t.u.removeEventListener(t.event,t.v,t.g)}i(t,s,i,h){s&&s.addEventListener(t,i,h),this.t.push({event:t,v:i,u:s,g:h})}o(t,s){this.t=this.t.filter(i=>!i||i.event!==t||i.u!==s||(this.m(i),!1))}}class i{constructor(t,s){this.imports=t,this.p=s,this.controls=[].slice.call(t.M._.querySelectorAll(".virchual__control")),t.A.s("destroy",()=>{console.log("controls component destroy")}),this.T=this.B.bind(this),this.mount()}mount(){this.controls.forEach(t=>this.imports.A.s("click",this.T,t))}B(s){t(s),"prev"!==s.target.closest("button").dataset.controls?this.imports.M.next():this.imports.M.prev()}}function h(t,{S:s,k:i}){const h=document.createElement(t);return h.className=s,h.innerHTML=i||"",h}function e(t){t&&t.parentElement&&t.parentElement.removeChild(t)}function n(t,s){t&&t.appendChild(s)}function o(t,s){t&&t.firstChild&&s&&t.insertBefore(s,t.firstChild)}function r(t,s,i=!1){i?t.classList.remove(s):t.classList.add(s)}function c(t,s=100){let i;return(...h)=>{clearTimeout(i),i=setTimeout(()=>requestAnimationFrame(()=>{i=null,t(...h)}),s)}}function l(t,s){return Array(s-t+1).fill(0).map((s,i)=>t+i)}function a(t,s){return t>s?0:t<0?s:t}const u=()=>{};function d(t,s,i){return[...l(s-i,s-1).map(s=>v(t,s)),t[s],...l(s+1,s+i).map(s=>v(t,s))]}function v(t,s){if(0===t.length)return;const i=s<0,h=s>t.length-1,e=i||h,n=h?-1:1,o=Math.max(Math.floor(Math.abs(s)/t.length),1);return e&&(s+=n*o*t.length),t[s]}function f(t){return t&&"picture"===t.nodeName.toLowerCase()}function m(t){const s=t.parentNode;return f(s)?s:t}class g{constructor(t,s){this.imports=t;const{D:i,I:h}=Object.assign({D:!0,I:"img,picture"},s);this.D=i,this.I=h,this.C={load:this.N.bind(this),error:this.$.bind(this)},this.D&&t.A.s({mounted:()=>{this.L()},move:()=>{this.L()}})}L(){this.j().forEach(t=>this.O(t))}j(){const t=d(l(0,this.imports.M.slides.length-1),this.imports.M.P,1),s=[];return t.forEach(t=>{const i=this.imports.M.slides[t];i.U&&[].forEach.call(i.V.querySelectorAll(this.I),t=>{f(t.parentElement)||s.push(t)})}),s}O(t){let s=!1;[].forEach.call(t.querySelectorAll("img,source"),t=>{const i=t.dataset.srcset,h=t.dataset.src;i&&(t.setAttribute("srcset",i),t.removeAttribute("data-srcset")),h&&(t.setAttribute("src",t.dataset.src),t.removeAttribute("data-src"),this.imports.A.s(this.C,t)),(i||h)&&(s=!0)}),s&&(t.classList.add("virchual__lazy"),t.classList.add("virchual__lazy--loading"))}N(t){const s=t.target;this.X(s)}$(t){const s=t.target;m(s).classList.add("virchual__lazy--failed"),this.X(s)}X(t){const s=m(t);s.classList.remove("virchual__lazy--loading"),s.classList.add("virchual__lazy--loaded"),this.imports.A.h(this.C,t)}}class p{constructor(t,{event:s}){this.frame=t,this.q=!1,this.A=s,this.F={Y:this.Y.bind(this),G:c(this.G.bind(this),1),H:this.H.bind(this)}}mount(){this.A.s("touchstart mousedown",this.F.Y,this.frame),this.A.s("touchmove mousemove",this.F.G,this.frame,{passive:!1}),this.A.s("touchend touchcancel mouseleave mouseup dragend",this.F.H,this.frame)}Y(s){t(s),this.q||(this.J=this.K(s,{}),this.R=this.J,this.A.l("dragstart",this.R))}G(s){t(s),this.J&&(this.R=this.K(s,this.J),this.q?(t(s),this.A.l("drag",this.R)):this.W(this.R)&&(this.A.l("drag",this.R),this.q=!0))}W({offset:t}){return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<45}H(){this.J=null,this.q&&(this.Z(this.R),this.q=!1)}Z(t){const s=t.tt.x;Math.abs(s)>0&&this.A.l("dragend",this.R)}K(t,s){const{timeStamp:i,touches:h}=t,{clientX:e,clientY:n}=h?h[0]:t,{x:o=e,y:r=n}=s.st||{},c={x:e-o,y:n-r},l=i-(s.time||0),a={x:c.x/l,y:c.y/l};return{offset:c,tt:a,st:{x:e,y:n},time:i,control:a.x<0?"next":"prev"}}}function y(t,s,i,h){return 0===t?t!==s:!(t!==i-1)&&s+1<h}function _(t,s,i){return s-i+t}class x{constructor(t,s,{it:i,ht:h}={}){this._=t,this.et=s,this.P=0,this.V=t.querySelector(".virchual__pagination"),this.nt=Math.min(s,null!=h?h:5),this.it=null!=i?i:16,this.ot=Math.floor(this.nt/2)}rt(){this.V=h("div",{S:"virchual__pagination"}),this.V.style.width=this.nt*this.it+"px",this.V.style.height=this.it+"px",l(0,Math.min(this.nt,this.et)-1).forEach(t=>{const s=y(t,t,this.nt,this.et),i=this.ct(t,{lt:s,at:t===this.P});n(this.V,i)}),n(this._,this.V)}next(){this.Z(1)}prev(){this.Z(-1)}Z(t){this.P=a(this.P+t,this.et-1);const s=(i=this.P,h=this.ot,e=this.et,i-Math.max(i-h,0)+Math.max(i-(-1+e-h),0));var i,h,e;const n=s===this.ot&&this.P>this.ot,o=n?1===t?0:this.nt-1:-1;if([].slice.call(this.V.querySelectorAll("span")).forEach((i,h)=>{this.ut({dt:i,index:h,sign:t,vt:n,ft:o,gt:s})}),n){const i=-1+this.nt-o,h=y(i,_(i,this.P,s),this.nt,this.et),e=this.ct(i,{lt:h});this.pt(t,e)}}ut({dt:t,index:s,gt:i,sign:h,vt:n,ft:o}){if(o===s)return e(t);const r=y(s-=n?h:0,_(s,this.P,i),this.nt,this.et);this.yt(t,{lt:r,at:s===i,position:n?s*this.it:void 0})}ct(t,{at:s,lt:i}={}){const e=h("span",{S:"virchual__pagination-bullet"});return this.yt(e,{at:s,lt:i,position:t*this.it}),e}yt(t,{at:s,lt:i,position:h}){r(t,"virchual__pagination-bullet--active",!s),r(t,"virchual__pagination-bullet--edge",!i),null!=h&&(t.style.transform=`translateX(${h}px)`)}pt(t,s){(1===t?n:o)(this.V,s)}}class M{constructor(t,s,i){this.frame=s,this.p=i,this.U=!1,this.at=!1,this._t=!1,"string"!=typeof t?(this.V=t,this.k=this.V.innerHTML,this.U=!0):this.k=t}set(t,s){this[t]=s,this._t=!0}rt(){return this.V=h("div",{S:"virchual__slide",k:this.k}),this.yt(),this.V}mount(t=!1){this.U?this._t&&this.update():(console.debug("[Mount] Slide",{V:this.V,prepend:t}),this.rt(),this.U=!0,this.V.addEventListener("transitionend",()=>{this.V.style.transition="",this.xt()}),(t?o:n)(this.frame,this.V))}unmount(){console.debug("[Unmount] Slide",{V:this.V}),this.U=!1,e(this.V)}translate(t,{easing:s,done:i}={}){this.xt=i||u,this.V.style.transition=s?`transform ${this.p.speed}ms ${this.p.easing}`:"",this.V.style.transform=`translate3d(calc(${this.position}% + ${Math.round(t)}px), 0, 0)`}update(){this._t=!1,this.yt()}yt(){r(this.V,"virchual__slide--active",!this.at),this.translate(0,{easing:!0})}}return class extends class{constructor(t,i={}){let h;this._=t,this.p=i,this.P=0,this.slides=[],this.Mt=!1,this.frame=this._.querySelector(".virchual__frame"),function(t){if(!t)throw new Error("Invalid element")}(this.frame),this.P=0,this.p=Object.assign({slides:[],speed:200,bt:150,Et:.6,wt:600,easing:"ease-out",zt:!0,window:1},i),this.A=new s,this.F={B:this.B.bind(this),At:this.At.bind(this),Tt:this.Tt.bind(this)};const e=this.p.slides;h="function"==typeof e?e():e,this.slides=this.Bt(),this.slides=this.slides.concat((h||[]).map(t=>new M(t,this.frame,this.p))),this.zt=new x(this._,this.slides.length),this.zt.rt()}register(t,s){new t({M:this,A:this.A},s)}mount(){console.debug("[Mount] Virchual"),this.St(),this.kt(),new p(this.frame,{event:this.A}).mount(),this.A.l("mounted")}disable(){}enable(){}s(t,s){this.A.s(t,s)}h(t){this.A.h(t)}prev(){console.debug("[Controls] Previous"),this.Z("prev")}next(){console.debug("[Controls] Next"),this.Z("next")}destroy(){this.A.destroy(),this.A.l("destroy")}Z(t){this.slides[this.P].translate(-100,{easing:!0,done:()=>{this.Mt=!1}});const s="prev"===t?-1:1;this.P=a(this.P+1*s,this.slides.length-1),this.St({control:t}),("prev"===t?this.zt.prev.bind(this.zt):this.zt.next.bind(this.zt))(),this.A.l("move",{index:this.P,control:t})}Bt(){return[].slice.call(this.frame.querySelectorAll("div")).map(t=>new M(t,this.frame,this.p))}St({control:t}={}){const s=this.slides[this.P],i=l(0,this.slides.length-1),h=this.p.window,e=d(i,this.P,h);d(i,this.P,h+1).forEach(i=>{const n=this.slides[i];i===this.P?s.set("isActive",!0):s.set("isActive",!1);const o=e.indexOf(i);if(o<0)return n.unmount();n.set("position",-100*(h-o));const r="prev"===t||null==t&&this.slides[0].U&&o-h<0;n.mount(r)})}kt(){this.A.s("drag",this.F.At),this.A.s("dragend",this.F.Tt),this.A.s("click",this.F.B,this.frame,{capture:!0})}B(s){this.Mt&&t(s)}At(t){this.Mt=!0;const s=d(l(0,this.slides.length-1),this.P,this.p.window),i="prev"===t.control?1:-1;s.forEach(s=>{const h=this.slides[s],e=i*Math.abs(t.offset.x);h.translate(e)})}Tt(t){console.debug("[Drag] Drag end",t),this.Z(t.control)}}{constructor(t,s={}){super(t,s),this.register(i,{isEnabled:!0}),this.register(g,{D:!0})}}}));
//# sourceMappingURL=virchual.bundle.min.js.map
