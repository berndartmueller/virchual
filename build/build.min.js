import build from './build';
import { terser } from 'rollup-plugin-terser';
import bundleSize from 'rollup-plugin-bundle-size';
import babel from '@rollup/plugin-babel';
import { resolve } from 'path';

const RESERVED = [
  // general
  'Virchual',

  // events
  'mounted',
  'move',
  'destroy',
  'dragstart',
  'drag',
  'dragend',
  'next',
  'prev',
  'register',
];

export default Object.assign(build, {
  plugins: build.plugins.concat([
    babel({
      extensions: ['.ts', '.js'],
      babelrc: false,
      babelrcRoots: ['.'],
      configFile: './babel.config.js',
    }),

    terser({
      compress: {
        drop_console: true,
        keep_fargs: false,
        passes: 2,
      },
      keep_fnames: false,
      ecma: 6,
      mangle: {
        properties: {
          keep_quoted: true,
          builtins: false,
          reserved: RESERVED,
        },
        toplevel: false,
      },
    }),
    bundleSize(),
  ]),
});
