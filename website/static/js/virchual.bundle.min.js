!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Virchual=s()}(this,(function(){"use strict";function t(t){t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())}class s{constructor(){this.t=[]}s(t,s,i,h={}){t.split(" ").forEach(t=>{i&&i.addEventListener(t,s,h),this.t.push({event:t,i:s,h:i,o:h})})}l(t,s){t.split(" ").forEach(t=>{this.t=this.t.filter(i=>{i&&i.event===t&&i.h===s&&this.u(i)})})}v(t,...s){this.t.forEach(i=>{i.h||i.event.split(".")[0]!==t||i.i(...s)})}m(){this.t.forEach(this.u),this.t=[]}u(t){t.h&&t.h.removeEventListener(t.event,t.i,t.o)}}class i{constructor(t,s){this.imports=t,this.g=s,this.controls=[].slice.call(t.M.p.querySelectorAll(".virchual__control")),t._.s("destroy",()=>{console.log("controls component destroy")}),this.A=this.T.bind(this),this.mount()}mount(){this.controls.forEach(t=>this.imports._.s("click",this.A,t))}T(s){t(s),"prev"!==s.target.closest("button").dataset.controls?this.imports.M.next():this.imports.M.prev()}}class h{constructor(t,s){this.imports=t;const{B:i,S:h,k:e}=Object.assign({B:!0,S:"img,picture",k:1},s);this.B=i,this.S=h,this.k=e,t._.s("mounted",()=>{this.D()}),t._.s("move",()=>{this.D()})}D(){this.I(this.imports.M.$,this.imports.M.$+1).forEach(t=>{this.C(t)})}C(t){[].forEach.call(t.getElementsByTagName("source"),t=>{const s=t.dataset.srcset;s&&(t.setAttribute("srcset",s),t.removeAttribute("data-srcset"))}),t.classList.add("loading")}I(t,s){t-this.k>=0&&(t-=this.k),this.imports.M.slides.length>s+this.k&&(s+=this.k);const i=[];for(;t<=s;){const s=this.imports.M.slides[t];t++,s.N&&[].forEach.call(s.j.querySelectorAll(this.S),t=>{i.push(t)})}return i}}function e(t,s=100){let i;return(...h)=>{clearTimeout(i),i=setTimeout(()=>requestAnimationFrame(()=>{i=null,t(...h)}),s)}}class n{constructor(t,{event:s}){this.frame=t,this.O=!1,this._=s,this.P={U:this.U.bind(this),V:e(this.V.bind(this),1),X:this.X.bind(this)}}mount(){this._.s("touchstart mousedown",this.P.U,this.frame),this._.s("touchmove mousemove",this.P.V,this.frame,{passive:!1}),this._.s("touchend touchcancel mouseleave mouseup dragend",this.P.X,this.frame)}U(s){t(s),this.O||(this.q=this.F(s,{}),this.L=this.q,this._.v("dragstart",this.L))}V(s){t(s),this.q&&(this.L=this.F(s,this.q),this.O?(t(s),this._.v("drag",this.L)):this.Y(this.L)&&(this._.v("drag",this.L),this.O=!0))}Y({offset:t}){return 180*Math.atan(Math.abs(t.y)/Math.abs(t.x))/Math.PI<45}X(){this.q=null,this.O&&(this.G(this.L),this.O=!1)}G(t){const s=t.H.x;Math.abs(s)>0&&this._.v("dragend",this.L)}F(t,s){const{timeStamp:i,touches:h}=t,{clientX:e,clientY:n}=h?h[0]:t,{x:o=e,y:r=n}=s.J||{},l={x:e-o,y:n-r},c=i-(s.time||0),a={x:l.x/c,y:l.y/c};return{offset:l,H:a,J:{x:e,y:n},time:i,control:a.x<0?"next":"prev"}}}function o(t,{K:s,R:i}){const h=document.createElement(t);return h.className=s,h.innerHTML=i||"",h}function r(t){t&&t.parentElement&&t.parentElement.removeChild(t)}function l(t,s){t&&t.appendChild(s)}function c(t,s){t&&t.firstChild&&s&&t.insertBefore(s,t.firstChild)}function a(t,s,i=!1){i?t.classList.remove(s):t.classList.add(s)}function u(t,s){return Array(s-t+1).fill(0).map((s,i)=>t+i)}function d(t,s){return t>s?0:t<0?s:t}const v=()=>{};function f(t,s,i,h){return 0===t?t!==s:!(t!==i-1)&&s+1<h}function m(t,s,i){return s-i+t}class g{constructor(t,s,{W:i,Z:h}={}){this.p=t,this.tt=s,this.$=0,this.j=t.querySelector(".virchual__pagination"),this.st=Math.min(s,null!=h?h:5),this.W=null!=i?i:16,this.it=Math.floor(this.st/2)}ht(){this.j=o("div",{K:"virchual__pagination"}),this.j.style.width=this.st*this.W+"px",this.j.style.height=this.W+"px",u(0,Math.min(this.st,this.tt)-1).forEach(t=>{const s=f(t,t,this.st,this.tt),i=this.et(t,{nt:s,ot:t===this.$});l(this.j,i)}),l(this.p,this.j)}next(){this.G(1)}prev(){this.G(-1)}G(t){this.$=d(this.$+t,this.tt-1);const s=(i=this.$,h=this.it,e=this.tt,i-Math.max(i-h,0)+Math.max(i-(-1+e-h),0));var i,h,e;const n=s===this.it&&this.$>this.it,o=n?1===t?0:this.st-1:-1;if([].slice.call(this.j.querySelectorAll("span")).forEach((i,h)=>{this.rt({lt:i,index:h,sign:t,ct:n,at:o,ut:s})}),n){const i=-1+this.st-o,h=f(i,m(i,this.$,s),this.st,this.tt),e=this.et(i,{nt:h});this.dt(t,e)}}rt({lt:t,index:s,ut:i,sign:h,ct:e,at:n}){if(n===s)return r(t);const o=f(s-=e?h:0,m(s,this.$,i),this.st,this.tt);this.vt(t,{nt:o,ot:s===i,position:e?s*this.W:void 0})}et(t,{ot:s,nt:i}={}){const h=o("span",{K:"virchual__pagination-bullet"});return this.vt(h,{ot:s,nt:i,position:t*this.W}),h}vt(t,{ot:s,nt:i,position:h}){a(t,"virchual__pagination-bullet--active",!s),a(t,"virchual__pagination-bullet--edge",!i),null!=h&&(t.style.transform=`translateX(${h}px)`)}dt(t,s){(1===t?l:c)(this.j,s)}}class p{constructor(t,s,i){this.frame=s,this.g=i,this.N=!1,this.ot=!1,this.ft=!1,"string"!=typeof t?(this.j=t,this.R=this.j.innerHTML,this.N=!0):this.R=t}set(t,s){this[t]=s,this.ft=!0}ht(){const t=o("div",{K:"virchual__slide",R:this.R});return this.vt(t),t}mount(t=!1){this.N?this.ft&&this.update():(console.debug("[Mount] Slide",{j:this.j,prepend:t}),this.j=this.ht(),this.N=!0,this.j.addEventListener("transitionend",this.gt),(t?c:l)(this.frame,this.j))}unmount(){console.debug("[Unmount] Slide",{j:this.j}),this.N=!1,r(this.j)}translate(t,{easing:s,done:i}={}){this.gt=i||v,this.j.style.transition=`transform ${this.g.speed}ms ${s?this.g.easing:"ease"}`,this.j.style.transform=`translate3d(calc(${this.position}% + ${Math.round(t)}px), 0, 0)`}update(){this.ft=!1,this.vt(this.j)}vt(t){a(t,"virchual__slide--active",!this.ot),t.style.transform=`translate3d(${this.position}%, 0, 0)`}}function y(t,s,i){return[...u(s-i,s-1).map(s=>x(t,s)),t[s],...u(s+1,s+i).map(s=>x(t,s))]}function x(t,s){if(0===t.length)return;const i=s<0,h=s>t.length-1,e=i||h,n=h?-1:1,o=Math.max(Math.floor(Math.abs(s)/t.length),1);return e&&(s+=n*o*t.length),t[s]}return class extends class{constructor(t,i={}){let h;this.p=t,this.g=i,this.$=0,this.slides=[],this.pt=!1,this.frame=this.p.querySelector(".virchual__frame"),function(t){if(!t)throw new Error("Invalid element")}(this.frame),this.$=0,this.g=Object.assign({slides:[],speed:200,yt:150,xt:.6,Mt:600,easing:"ease-out",bt:!0,window:1},i),this._=new s,this.P={T:this.T.bind(this),_t:this._t.bind(this),Et:this.Et.bind(this)};const e=this.g.slides;h="function"==typeof e?e():e,this.slides=this.wt(),this.slides=this.slides.concat((h||[]).map(t=>new p(t,this.frame,this.g))),this.bt=new g(this.p,this.slides.length),this.bt.ht()}register(t,s){new t({M:this,_:this._},s)}mount(){console.debug("[Mount] Virchual"),this.At(),this.Tt(),new n(this.frame,{event:this._}).mount(),this._.v("mounted")}disable(){}enable(){}s(t,s){this._.s(t,s)}l(t){this._.l(t)}prev(){console.debug("[Controls] Previous"),this.G("prev")}next(){console.debug("[Controls] Next"),this.G("next")}m(){this._.m(),this._.v("destroy")}G(t){this.slides[this.$].translate(-100,{easing:!0,done:()=>{this.pt=!1}});const s="prev"===t?-1:1;this.$=d(this.$+1*s,this.slides.length-1),this.At({control:t}),("prev"===t?this.bt.prev.bind(this.bt):this.bt.next.bind(this.bt))(),this._.v("move",{index:this.$,control:t})}wt(){return[].slice.call(this.frame.querySelectorAll("div")).map(t=>new p(t,this.frame,this.g))}At({control:t}={}){const s=this.slides[this.$],i=u(0,this.slides.length-1),h=this.g.window,e=y(i,this.$,h);y(i,this.$,h+1).forEach(i=>{const n=this.slides[i];i===this.$?s.set("isActive",!0):s.set("isActive",!1);const o=e.indexOf(i);if(o<0)return n.unmount();n.set("position",-100*(h-o));const r="prev"===t||null==t&&this.slides[0].N&&o-h<0;n.mount(r)})}Tt(){this._.s("drag",this.P._t),this._.s("dragend",this.P.Et),this._.s("click",this.P.T,this.frame,{capture:!0})}T(s){this.pt&&t(s)}_t(t){this.pt=!0;const s=y(u(0,this.slides.length-1),this.$,this.g.window),i="prev"===t.control?1:-1;s.forEach(s=>{const h=this.slides[s],e=i*Math.abs(t.offset.x);h.translate(e)})}Et(t){console.debug("[Drag] Drag end",t),this.G(t.control)}}{constructor(t,s={}){super(t,s),this.register(i,{isEnabled:!0}),this.register(h,{B:!1})}}}));
//# sourceMappingURL=virchual.bundle.min.js.map
