!(function (t, i) {
  'object' == typeof exports && 'undefined' != typeof module
    ? (module.exports = i())
    : 'function' == typeof define && define.amd
    ? define(i)
    : ((t = t || self).Virchual = i());
})(this, function () {
  var t, i, n, s, h, o, u, r, e, c;
  function a() {
    return (a =
      Object.assign ||
      function (t) {
        var i, n, s;
        for (i = 1; i < arguments.length; i++) for (s in (n = arguments[i])) Object.prototype.hasOwnProperty.call(n, s) && (t[s] = n[s]);
        return t;
      }).apply(this, arguments);
  }
  function f(t) {
    t && (t.stopImmediatePropagation(), t.stopPropagation(), t.preventDefault());
  }
  function v(t, i) {
    var n = i.classNames,
      s = i.html,
      h = document.createElement(t);
    return (h.className = n), (h.innerHTML = s || ''), h;
  }
  function l(t) {
    t && t.parentElement && t.parentElement.removeChild(t);
  }
  function d(t, i) {
    t && t.appendChild(i);
  }
  function p(t, i) {
    t && t.firstChild && i && t.insertBefore(i, t.firstChild);
  }
  function m(t, i, n) {
    void 0 === n && (n = !1), n ? t.classList.remove(i) : t.classList.add(i);
  }
  function g(t, i) {
    return Array(i - t + 1)
      .fill(0)
      .map(function (i, n) {
        return t + n;
      });
  }
  function _(t, i) {
    return t > i ? 0 : t < 0 ? i : t;
  }
  function y(t) {
    return requestAnimationFrame(t);
  }
  function M(t, i) {
    return setTimeout(t, i);
  }
  function x(t, i, n) {
    var s, h, o;
    return t.length < 2
      ? t
      : ((s = g(i - n, i - 1).map(function (i) {
          return w(t, i);
        })),
        (h = [t[i]]),
        (o = g(i + 1, i + n).map(function (i) {
          return w(t, i);
        })),
        [].concat(s, h, o));
  }
  function w(t, i) {
    var n, s, h, o;
    if (0 !== t.length)
      return (
        (n = i > t.length - 1),
        (s = i < 0 || n),
        (h = n ? -1 : 1),
        (o = Math.max(Math.floor(Math.abs(i) / t.length), 1)),
        s && (i += h * o * t.length),
        t[i]
      );
  }
  function b(t) {
    return t && 'picture' === t.nodeName.toLowerCase();
  }
  function z(t) {
    var i = t.parentNode;
    return b(i) ? i : t;
  }
  function A(t, i, n, s) {
    return 0 === t ? t !== i : !(t !== n - 1) && i + 1 < s;
  }
  function E(t, i, n) {
    return i - n + t;
  }
  return (
    (t = (function () {
      function t() {
        this.t = [];
      }
      var i = t.prototype;
      return (
        (i.on = function (t, i, n, s) {
          var h,
            o = this;
          if ((void 0 === s && (s = {}), 'string' == typeof t))
            t.split(' ').forEach(function (t) {
              return o.i(t, n, i, s);
            });
          else for (h in t) this.i(h, i, t[h], s);
        }),
        (i.off = function (t, i) {
          var n,
            s = this;
          if ('string' == typeof t)
            t.split(' ').forEach(function (t) {
              return s.s(t, i);
            });
          else for (n in t) this.s(n, i);
        }),
        (i.emit = function (t) {
          var i = arguments;
          this.t.forEach(function (n) {
            n.elm || n.event.split('.')[0] !== t || n.handler.apply(n, [].slice.call(i, 1));
          });
        }),
        (i.destroy = function () {
          this.t.forEach(this.h), (this.t = []);
        }),
        (i.h = function (t) {
          t.elm && t.elm.removeEventListener(t.event, t.handler, t.opts);
        }),
        (i.i = function (t, i, n, s) {
          i && i.addEventListener(t, n, s), this.t.push({ event: t, handler: n, elm: i, opts: s });
        }),
        (i.s = function (t, i) {
          var n = this;
          this.t = this.t.filter(function (s) {
            return !s || s.event !== t || s.elm !== i || (n.h(s), !1);
          });
        }),
        t
      );
    })()),
    (i = (function () {
      function t(t, i) {
        (this.o = t),
          (this.u = i),
          (this.v = [].slice.call(t.virchual.container.querySelectorAll('.virchual__control'))),
          t.eventBus.on('destroy', function () {}),
          (this.l = this.p.bind(this)),
          this.mount();
      }
      var i = t.prototype;
      return (
        (i.mount = function () {
          var t = this;
          this.v.forEach(function (i) {
            return t.o.eventBus.on('click', t.l, i);
          });
        }),
        (i.p = function (t) {
          f(t), 'prev' !== t.target.closest('button').dataset.controls ? this.o.virchual.next() : this.o.virchual.prev();
        }),
        t
      );
    })()),
    (n = function () {}),
    (s = 'virchual__lazy' + '--loading'),
    'virchual__lazy--failed',
    'virchual__lazy--loaded',
    (h = (function () {
      function t(t, i) {
        var n,
          s,
          h = this;
        (this.o = t),
          (s = (n = a({ lazyload: !0, lazyloadSelector: 'img,picture' }, i)).lazyloadSelector),
          (this.m = n.lazyload),
          (this.g = s),
          (this._ = { load: this.M.bind(this), error: this.A.bind(this) }),
          this.m &&
            t.eventBus.on({
              mounted: function () {
                h.B();
              },
              move: function () {
                h.B();
              },
            });
      }
      var i = t.prototype;
      return (
        (i.B = function () {
          var t = this;
          this.k().forEach(function (i) {
            return t.j(i);
          });
        }),
        (i.k = function () {
          var t = this,
            i = x(g(0, this.o.virchual.getSlides(!0).length - 1), this.o.virchual.currentIndex, 1),
            n = [];
          return (
            i.forEach(function (i) {
              var s = t.o.virchual.getSlides(!0)[i];
              s.isMounted &&
                [].forEach.call(s.ref.querySelectorAll(t.g), function (t) {
                  b(t.parentElement) || n.push(t);
                });
            }),
            n
          );
        }),
        (i.j = function (t) {
          var i = this,
            n = !1;
          [].forEach.call(t.querySelectorAll('img,source'), function (t) {
            var s = t.dataset.srcset,
              h = t.dataset.src;
            s && (t.setAttribute('srcset', s), t.removeAttribute('data-srcset')),
              h && (t.setAttribute('src', t.dataset.src), t.removeAttribute('data-src'), i.o.eventBus.on(i._, t)),
              (s || h) && (n = !0);
          }),
            n && (t.classList.add('virchual__lazy'), t.classList.add(s));
        }),
        (i.M = function (t) {
          this.D(t.target);
        }),
        (i.A = function (t) {
          var i = t.target;
          z(i).classList.add('virchual__lazy--failed'), this.D(i);
        }),
        (i.D = function (t) {
          var i = z(t);
          i.classList.remove(s), i.classList.add('virchual__lazy--loaded'), this.o.eventBus.off(this._, t);
        }),
        t
      );
    })()),
    (o = (function () {
      function t(t, i) {
        var n,
          s,
          h,
          o = i.event;
        (this.I = t),
          (this.T = !1),
          (this.N = o),
          (this.O = {
            onStart: this.S.bind(this),
            onMove:
              ((n = this.q.bind(this)),
              (s = 1),
              void 0 === s && (s = 100),
              function () {
                var t = arguments;
                clearTimeout(h),
                  (h = M(function () {
                    y(function () {
                      (h = null), n.apply(void 0, [].slice.call(t));
                    });
                  }, s));
              }),
            onEnd: this.C.bind(this),
          });
      }
      var i = t.prototype;
      return (
        (i.mount = function () {
          this.N.on('touchstart mousedown', this.O.onStart, this.I),
            this.N.on('touchmove mousemove', this.O.onMove, this.I, { passive: !1 }),
            this.N.on('touchend touchcancel mouseleave mouseup dragend', this.O.onEnd, this.I);
        }),
        (i.S = function (t) {
          f(t), this.T || ((this.F = this.P(t, {})), (this.V = this.F), this.N.emit('dragstart', this.V));
        }),
        (i.q = function (t) {
          f(t),
            this.F &&
              ((this.V = this.P(t, this.F)),
              this.T ? (f(t), this.N.emit('drag', this.V)) : this.X(this.V) && (this.N.emit('drag', this.V), (this.T = !0)));
        }),
        (i.X = function (t) {
          var i = t.offset;
          return (180 * Math.atan(Math.abs(i.y) / Math.abs(i.x))) / Math.PI < 45;
        }),
        (i.C = function () {
          (this.F = null), this.T && (this.G(this.V), (this.T = !1));
        }),
        (i.G = function (t) {
          Math.abs(t.velocity.x) > 0 && this.N.emit('dragend', this.V);
        }),
        (i.P = function (t, i) {
          var n = t.timeStamp,
            s = t.touches,
            h = s ? s[0] : t,
            o = h.clientX,
            u = h.clientY,
            r = i.to || {},
            e = r.x,
            c = r.y,
            a = { x: o - (void 0 === e ? o : e), y: u - (void 0 === c ? u : c) },
            f = n - (i.time || 0),
            v = { x: a.x / f, y: a.y / f };
          return { offset: a, velocity: v, to: { x: o, y: u }, time: n, control: v.x < 0 ? 'next' : 'prev' };
        }),
        t
      );
    })()),
    (r = {
      slide: (u = 'virchual' + '__slide'),
      slideActive: u + '--active',
      pagination: 'virchual__pagination',
      paginationBullet: 'virchual__pagination-bullet',
      paginationBulletActive: 'virchual__pagination-bullet--active',
      paginationBulletEdge: 'virchual__pagination-bullet--edge',
    }),
    (e = (function () {
      function t(t, i, n) {
        var s = void 0 === n ? {} : n,
          h = s.diameter,
          o = s.bullets,
          u = s.isActive;
        (this.H = t),
          (this.J = i),
          (this.K = 0),
          (this.L = !0),
          (this.R = t.querySelector('.' + r.pagination)),
          (this.U = Math.min(i, null != o ? o : 5)),
          (this.W = null != h ? h : 16),
          (this.L = null == u || u),
          (this.Y = Math.floor(this.U / 2));
      }
      var i = t.prototype;
      return (
        (i.render = function () {
          var t = this;
          !this.L || this.J < 2
            ? (this.L = !1)
            : ((this.R = v('div', { classNames: r.pagination })),
              (this.R.style.width = this.U * this.W + 'px'),
              (this.R.style.height = this.W + 'px'),
              g(0, Math.min(this.U, this.J) - 1).forEach(function (i) {
                var n = A(i, i, t.U, t.J),
                  s = t.Z(i, { isEdge: n, isActive: i === t.K });
                d(t.R, s);
              }),
              d(this.H, this.R));
        }),
        (i.next = function () {
          this.G(1);
        }),
        (i.prev = function () {
          this.G(-1);
        }),
        (i.G = function (t) {
          var i,
            n,
            s,
            h,
            o,
            u,
            r,
            e,
            c,
            a = this;
          this.L &&
            ((this.K = _(this.K + t, this.J - 1)),
            (r = this.K),
            (e = this.Y),
            (i = this.U >= (c = this.J) ? r : r - Math.max(r - e, 0) + Math.max(r - (-1 + c - e), 0)),
            (s = (n = i === this.Y && this.K > this.Y) ? (1 === t ? 0 : this.U - 1) : -1),
            [].slice.call(this.R.querySelectorAll('span')).forEach(function (h, o) {
              a.$({ bullet: h, index: o, sign: t, removeBullet: n, removeBulletIndex: s, activeIndex: i });
            }),
            n && ((o = A((h = -1 + this.U - s), E(h, this.K, i), this.U, this.J)), (u = this.Z(h, { isEdge: o })), this.tt(t, u)));
        }),
        (i.$ = function (t) {
          var i,
            n = t.bullet,
            s = t.index,
            h = t.activeIndex,
            o = t.removeBullet;
          t.removeBulletIndex !== s
            ? ((i = A((s -= o ? t.sign : 0), E(s, this.K, h), this.U, this.J)),
              this.it(n, { isEdge: i, isActive: s === h, position: o ? s * this.W : void 0 }))
            : l(n);
        }),
        (i.Z = function (t, i) {
          var n = void 0 === i ? {} : i,
            s = n.isActive,
            h = n.isEdge,
            o = v('span', { classNames: r.paginationBullet });
          return this.it(o, { isActive: s, isEdge: h, position: t * this.W }), o;
        }),
        (i.it = function (t, i) {
          var n = i.isEdge,
            s = i.position;
          m(t, r.paginationBulletActive, !i.isActive),
            m(t, r.paginationBulletEdge, !n),
            null != s && (t.style.transform = 'translateX(' + s + 'px)');
        }),
        (i.tt = function (t, i) {
          (1 === t ? d : p)(this.R, i);
        }),
        t
      );
    })()),
    (c = (function () {
      function t(t, i, s) {
        (this.I = i),
          (this.o = s),
          (this.isMounted = !1),
          (this.isActive = !1),
          (this.isClone = !1),
          (this.nt = !1),
          (this.st = n),
          (this.ht = n),
          'string' != typeof t ? ((this.ref = t), (this.ot = this.ref.innerHTML), (this.isMounted = !0), this.ut()) : (this.ot = t);
      }
      var i = t.prototype;
      return (
        (i.set = function (t, i) {
          (this[t] = i), (this.nt = !0);
        }),
        (i.mount = function (t) {
          var i = this;
          void 0 === t && (t = !1),
            this.rt(function () {
              i.isMounted ? i.nt && i.et() : (i.ct(), (i.isMounted = !0), i.ut(), (t ? p : d)(i.I, i.ref));
            });
        }),
        (i.unmount = function () {
          var t = this;
          (this.isMounted = !1),
            this.rt(function () {
              l(t.ref);
            });
        }),
        (i.clone = function () {
          var i = new t(this.ot, this.I, this.o);
          return (i.isClone = !0), i;
        }),
        (i.translate = function (t, i) {
          var s = void 0 === i ? {} : i,
            h = s.easing;
          (this.st = s.done || n),
            h
              ? ((this.at = !0),
                (this.ref.style.transition = 'transform ' + this.o.virchual.settings.speed + 'ms ' + this.o.virchual.settings.easing))
              : (this.ref.style.transition = ''),
            (this.ref.style.transform = 'translate3d(calc(' + this.position + '% + ' + t + '), 0, 0)');
        }),
        (i.ct = function () {
          return (this.ref = v('div', { classNames: r.slide, html: this.ot })), this.it(), this.ref;
        }),
        (i.ut = function () {
          var t = this;
          this.ref.addEventListener('transitionend', function () {
            (t.at = !1), (t.ref.style.transition = ''), t.ht(), t.st();
          }),
            this.o.eventBus.on('move', function () {
              t.at = !1;
            });
        }),
        (i.et = function () {
          (this.nt = !1), this.it();
        }),
        (i.it = function () {
          m(this.ref, r.slideActive, !this.isActive), this.ref.setAttribute('data-idx', this.idx + ''), this.translate('0%');
        }),
        (i.rt = function (t) {
          var i = this;
          this.at
            ? (this.ht = function () {
                t(), (i.ht = n);
              })
            : t();
        }),
        t
      );
    })()),
    (function (t) {
      var n, s;
      function o(n, s) {
        var o;
        return (
          void 0 === s && (s = {}), (o = t.call(this, n, s) || this).register(i, { isEnabled: !0 }), o.register(h, { lazyload: !0 }), o
        );
      }
      return (s = t), ((n = o).prototype = Object.create(s.prototype)), (n.prototype.constructor = n), (n.__proto__ = s), o;
    })(
      (function () {
        function i(i, n) {
          var s, h, o;
          void 0 === n && (n = {}),
            (this.container = i),
            (this.settings = n),
            (this.currentIndex = 0),
            (this.ft = []),
            (this.vt = []),
            (this.lt = !1),
            (this.frame = this.container.querySelector('.virchual__frame')),
            (function (t) {
              if (!t) throw new Error('Invalid element');
            })(this.frame),
            (this.currentIndex = 0),
            (this.settings = a(
              {
                slides: [],
                speed: 200,
                swipeDistanceThreshold: 150,
                flickVelocityThreshold: 0.6,
                flickPower: 600,
                easing: 'ease-out',
                pagination: !0,
                window: 1,
              },
              n,
            )),
            (this.N = new t()),
            (this.O = { onClick: this.p.bind(this), onDrag: this.dt.bind(this), onDragEnd: this.pt.bind(this) }),
            (s = this.gt()),
            (h = this._t()),
            (this.ft = [].concat(s, h)),
            (o = this.yt()),
            (this.ft = [].concat(this.ft, o)),
            (this.settings.window = Math.min(this.settings.window, Math.max(this.getSlidesLength() - 1, 0))),
            (this.Mt = new e(this.container, this.getSlidesLength(), { isActive: this.settings.pagination })),
            this.Mt.render();
        }
        var n = i.prototype;
        return (
          (n.getSlides = function (t) {
            return (
              void 0 === t && (t = !1),
              t
                ? this.ft
                : this.ft.filter(function (t) {
                    return !t.isClone;
                  })
            );
          }),
          (n.getSlidesLength = function (t) {
            return void 0 === t && (t = !1), this.getSlides(t).length;
          }),
          (n.register = function (t, i) {
            new t({ virchual: this, eventBus: this.N }, i);
          }),
          (n.mount = function () {
            this.getSlidesLength() < 2 || (this.xt(), this.ut(), new o(this.frame, { event: this.N }).mount(), this.N.emit('mounted'));
          }),
          (n.disable = function () {}),
          (n.enable = function () {}),
          (n.on = function (t, i) {
            this.N.on(t, i);
          }),
          (n.off = function (t) {
            this.N.off(t);
          }),
          (n.prev = function () {
            this.G('prev');
          }),
          (n.next = function () {
            this.G('next');
          }),
          (n.destroy = function () {
            this.N.destroy(), this.N.emit('destroy');
          }),
          (n.G = function (t) {
            var i = this,
              n = 'prev' === t ? -1 : 1,
              s = this.currentIndex + 1 * n,
              h = _(s, this.getSlidesLength() - 1),
              o = -100 * n + '%',
              u = function () {
                (i.lt = !1),
                  (i.currentIndex = h),
                  i.xt({ control: t }),
                  ('prev' === t ? i.Mt.prev.bind(i.Mt) : i.Mt.next.bind(i.Mt))(),
                  i.N.emit('move', { index: i.currentIndex, control: t });
              };
            h !== s ? this.wt(o, n, { callback: u }) : (this.wt(o, n), u());
          }),
          (n._t = function () {
            var t = this,
              i = this.settings.slides;
            return (('function' == typeof i ? i() : i) || []).map(function (i) {
              return new c(i, t.frame, { virchual: t, eventBus: t.N });
            });
          }),
          (n.gt = function () {
            var t = this;
            return [].slice.call(this.frame.children).map(function (i) {
              return new c(i, t.frame, { virchual: t, eventBus: t.N });
            });
          }),
          (n.yt = function () {
            var t,
              i,
              n = this.getSlidesLength(),
              s = [];
            if (n >= 2 * this.settings.window + 1) return s;
            for (t = n - 1; t >= n - this.settings.window; t--) (i = this.ft[t].clone()), s.push(i);
            return s;
          }),
          (n.xt = function (t) {
            var i = this,
              n = (void 0 === t ? {} : t).control,
              s = this.settings.window,
              h = g(0, this.getSlidesLength() - 1),
              o = x(g(0, this.getSlidesLength(!0) - 1), this.currentIndex, s),
              u = x(h, this.currentIndex, s);
            this.bt(o, this.vt).forEach(function (t) {
              var s,
                h,
                o = t.slideIndex,
                r = u[t.index],
                e = o === i.currentIndex,
                c =
                  ((h = o),
                  i.ft.find(function (t) {
                    return t.idx === h;
                  }) || i.ft[o]);
              'mount' === t.action.type
                ? ((s = 'prev' === n || t.action.centerDistance < 0),
                  null == c && ((c = i.ft[r].clone()), i.ft.splice(o, 0, c)),
                  (c.idx = o),
                  c.set('isActive', e),
                  c.set('position', 100 * t.action.centerDistance),
                  c.mount(s))
                : (c.unmount(), c.isClone && i.ft.splice(o, 1));
            }),
              (this.vt = o);
          }),
          (n.bt = function (t, i) {
            return [].concat(
              this.zt((i = i || []), t, function (t, i) {
                if (!t) return (i.action.type = 'unmount'), i;
              }),
              this.zt(t, []),
            );
          }),
          (n.zt = function (t, i, n) {
            var s = [];
            return (
              t.forEach(function (h, o) {
                var u = { index: o, slideIndex: h, action: { type: 'mount', centerDistance: o - Math.floor(t.length / 2) } };
                (u = null != n ? n(0 === i[o - 1] - h || 0 === i[o + 1] - h, u) : u) && s.push(u);
              }),
              s
            );
          }),
          (n.ut = function () {
            this.N.on('drag', this.O.onDrag),
              this.N.on('dragend', this.O.onDragEnd),
              this.N.on('click', this.O.onClick, this.frame, { capture: !0 });
          }),
          (n.p = function (t) {
            this.lt && f(t);
          }),
          (n.dt = function (t) {
            var i, n;
            (this.lt = !0),
              (n = -1 * (i = 'prev' === t.control ? -1 : 1) * Math.abs(t.offset.x)),
              this.wt(Math.round(n) + 'px', i, { easing: !1 });
          }),
          (n.wt = function (t, i, n) {
            var s = this,
              h = void 0 === n ? {} : n,
              o = h.easing,
              u = h.callback,
              r = x(g(0, this.getSlidesLength(!0) - 1), this.currentIndex, this.settings.window);
            (r = i > 0 ? r.slice(-1 * (this.settings.window + 1)) : r.slice(0, this.settings.window + 1)).forEach(function (i) {
              s.ft[i].translate(t, {
                easing: null == o || o,
                done: function () {
                  u && (u(), (u = null));
                },
              });
            });
          }),
          (n.pt = function (t) {
            this.G(t.control);
          }),
          i
        );
      })(),
    )
  );
});
//# sourceMappingURL=virchual.umd.js.map
