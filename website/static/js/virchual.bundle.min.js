!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).Virchual=i()}(this,(function(){"use strict";function t(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function i(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.t=e.t||!1,e.i=!0,"value"in e&&(e.s=!0),Object.defineProperty(t,e.key,e)}}function n(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function e(t){return(e=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,i){return(s=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function u(t,i){return!i||"object"!=typeof i&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):i}function r(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t){if(t){if("string"==typeof t)return o(t,undefined);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,undefined):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,i){(null==i||i>t.length)&&(i=t.length);for(var n=0,e=new Array(i);n<i;n++)e[n]=t[n];return e}function h(t){t&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())}var a=function(){function i(){t(this,i),this.u=[]}return n(i,[{key:"on",value:function(t,i,n){var e=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("string"==typeof t)t.split(" ").forEach((function(t){return e.o(t,n,i,s)}));else for(var u in t)this.o(u,i,t[u],s)}},{key:"off",value:function(t,i){var n=this;if("string"==typeof t)t.split(" ").forEach((function(t){return n.h(t,i)}));else for(var e in t)this.h(e,i)}},{key:"emit",value:function(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];this.u.forEach((function(i){i.l||i.event.split(".")[0]!==t||i.v.apply(i,n)}))}},{key:"destroy",value:function(){this.u.forEach(this.k),this.u=[]}},{key:"unroll",value:function(t){t.l&&t.l.removeEventListener(t.event,t.v,t.p)}},{key:"addEvent",value:function(t,i,n,e){i&&i.addEventListener(t,n,e),this.u.push({event:t,v:n,l:i,p:e})}},{key:"removeEvent",value:function(t,i){var n=this;this.u=this.u.filter((function(e){return!e||e.event!==t||e.l!==i||(n.k(e),!1)}))}}]),i}(),c=function(){function i(n,e){t(this,i),this.imports=n,this.m=e,this.controls=[].slice.call(n._.g.querySelectorAll(".virchual__control")),n.A.M("destroy",(function(){})),this.j=this.T.bind(this),this.mount()}return n(i,[{key:"mount",value:function(){var t=this;this.controls.forEach((function(i){return t.imports.A.M("click",t.j,i)}))}},{key:"onClick",value:function(t){h(t),"prev"!==t.target.closest("button").dataset.controls?this.imports._.next():this.imports._.prev()}}]),i}();function f(t,i){var n=i.S,e=i.O,s=document.createElement(t);return s.className=n,s.innerHTML=e||"",s}function l(t){t&&t.parentElement&&t.parentElement.removeChild(t)}function v(t,i){t&&t.appendChild(i)}function d(t,i){t&&t.firstChild&&i&&t.insertBefore(i,t.firstChild)}function y(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?t.classList.remove(i):t.classList.add(i)}function k(t,i){if(!t)throw new Error(i)}function p(t,i){return Array(i-t+1).fill(0).map((function(i,n){return t+n}))}function m(t,i){return t>i?0:t<0?i:t}function g(t){return requestAnimationFrame(t)}function b(t,i){return setTimeout(t,i)}var _=function(){};function w(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var e=arguments.length,s=new Array(e),u=0;u<e;u++)s[u]=arguments[u];clearTimeout(i),i=b((function(){g((function(){i=null,t.apply(void 0,s)}))}),n)}}function M(t,i,n){if(t.length<2)return t;var e=p(i-n,i-1).map((function(i){return x(t,i)})),s=[t[i]],u=p(i+1,i+n).map((function(i){return x(t,i)}));return[].concat(r(e),s,r(u))}function x(t,i){if(0!==t.length){var n=i<0,e=i>t.length-1,s=n||e,u=e?-1:1,r=Math.max(Math.floor(Math.abs(i)/t.length),1);return s&&(i+=u*r*t.length),t[i]}}var A="".concat("virchual__lazy","--loading"),E="".concat("virchual__lazy","--failed"),j="".concat("virchual__lazy","--loaded");function T(t){return t&&"picture"===t.nodeName.toLowerCase()}function S(t){var i=t.parentNode;return T(i)?i:t}var O=function(){function i(n,e){var s=this;t(this,i),this.imports=n;var u=Object.assign({D:!0,I:"img,picture"},e),r=u.D,o=u.I;this.D=r,this.I=o,this.B={load:this.C.bind(this),error:this.R.bind(this)},this.D&&n.A.M({mounted:function(){s.L()},move:function(){s.L()}})}return n(i,[{key:"doLazyLoad",value:function(){var t=this;this.N().forEach((function(i){return t.P(i)}))}},{key:"getImages",value:function(){var t=this,i=M(p(0,this.imports._.U(!0).length-1),this.imports._.q,1),n=[];return i.forEach((function(i){var e=t.imports._.U(!0)[i];e.F&&[].forEach.call(e.V.querySelectorAll(t.I),(function(t){T(t.parentElement)||n.push(t)}))})),n}},{key:"loadImage",value:function(t){var i=this,n=!1;[].forEach.call(t.querySelectorAll("img,source"),(function(t){var e=t.dataset.srcset,s=t.dataset.src;e&&(t.setAttribute("srcset",e),t.removeAttribute("data-srcset")),s&&(t.setAttribute("src",t.dataset.src),t.removeAttribute("data-src"),i.imports.A.M(i.B,t)),(e||s)&&(n=!0)})),n&&(t.classList.add("virchual__lazy"),t.classList.add(A))}},{key:"onLoad",value:function(t){var i=t.target;this.X(i)}},{key:"onError",value:function(t){var i=t.target;S(i).classList.add(E),this.X(i)}},{key:"completeLoading",value:function(t){var i=S(t);i.classList.remove(A),i.classList.add(j),this.imports.A.$(this.B,t)}}]),i}(),z=function(){function i(n,e){var s=e.event;t(this,i),this.frame=n,this.G=!1,this.A=s,this.H={J:this.J.bind(this),K:w(this.K.bind(this),1),W:this.W.bind(this)}}return n(i,[{key:"mount",value:function(){this.A.M("touchstart mousedown",this.H.J,this.frame),this.A.M("touchmove mousemove",this.H.K,this.frame,{passive:!1}),this.A.M("touchend touchcancel mouseleave mouseup dragend",this.H.W,this.frame)}},{key:"onStart",value:function(t){h(t),this.G||(this.Y=this.Z(t,{}),this.tt=this.Y,this.A.it("dragstart",this.tt))}},{key:"onMove",value:function(t){h(t),this.Y&&(this.tt=this.Z(t,this.Y),this.G?(h(t),this.A.it("drag",this.tt)):this.nt(this.tt)&&(this.A.it("drag",this.tt),this.G=!0))}},{key:"shouldMove",value:function(t){var i=t.offset;return 180*Math.atan(Math.abs(i.y)/Math.abs(i.x))/Math.PI<45}},{key:"onEnd",value:function(){this.Y=null,this.G&&(this.et(this.tt),this.G=!1)}},{key:"goTo",value:function(t){var i=t.st.x;Math.abs(i)>0&&this.A.it("dragend",this.tt)}},{key:"analyze",value:function(t,i){var n=t.timeStamp,e=t.touches,s=e?e[0]:t,u=s.clientX,r=s.clientY,o=i.ut||{},h=o.x,a=void 0===h?u:h,c=o.y,f={x:u-a,y:r-(void 0===c?r:c)},l=n-(i.time||0),v={x:f.x/l,y:f.y/l};return{offset:f,st:v,ut:{x:u,y:r},time:n,control:v.x<0?"next":"prev"}}}]),i}();function D(t,i,n,e){return 0===t?t!==i:!(t!==n-1)&&i+1<e}function I(t,i,n){return i-n+t}var B=function(){function i(n,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=s.rt,r=s.ot,o=s.ht;t(this,i),this.g=n,this.at=e,this.q=0,this.ht=!0,this.V=n.querySelector(".virchual__pagination"),this.ct=Math.min(e,null!=r?r:5),this.rt=null!=u?u:16,this.ht=null==o||o,this.ft=Math.floor(this.ct/2)}return n(i,[{key:"render",value:function(){var t=this;!this.ht||this.at<2?this.ht=!1:(this.V=f("div",{S:"virchual__pagination"}),this.V.style.width="".concat(this.ct*this.rt,"px"),this.V.style.height="".concat(this.rt,"px"),p(0,Math.min(this.ct,this.at)-1).forEach((function(i){var n=D(i,i,t.ct,t.at),e=t.lt(i,{vt:n,ht:i===t.q});v(t.V,e)})),v(this.g,this.V))}},{key:"next",value:function(){this.et(1)}},{key:"prev",value:function(){this.et(-1)}},{key:"goTo",value:function(t){var i,n,e,s,u=this;if(this.ht){this.q=m(this.q+t,this.at-1);var r=(i=this.q,n=this.ft,e=this.ct,s=this.at,e>=s?i:i-Math.max(i-n,0)+Math.max(i-(-1+s-n),0)),o=r===this.ft&&this.q>this.ft,h=o?1===t?0:this.ct-1:-1;if([].slice.call(this.V.querySelectorAll("span")).forEach((function(i,n){u.dt({yt:i,index:n,sign:t,kt:o,pt:h,gt:r})})),o){var a=-1+this.ct-h,c=D(a,I(a,this.q,r),this.ct,this.at),f=this.lt(a,{vt:c});this.bt(t,f)}}}},{key:"handleBulletMovement",value:function(t){var i=t.yt,n=t.index,e=t.gt,s=t.sign,u=t.kt;if(t.pt!==n){var r=D(n-=u?s:0,I(n,this.q,e),this.ct,this.at);this._t(i,{vt:r,ht:n===e,position:u?n*this.rt:void 0})}else l(i)}},{key:"renderBullet",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.ht,e=i.vt,s=f("span",{S:"virchual__pagination-bullet"});return this._t(s,{ht:n,vt:e,position:t*this.rt}),s}},{key:"setAttributes",value:function(t,i){var n=i.ht,e=i.vt,s=i.position;y(t,"virchual__pagination-bullet--active",!n),y(t,"virchual__pagination-bullet--edge",!e),null!=s&&(t.style.transform="translateX(".concat(s,"px)"))}},{key:"insertBullet",value:function(t,i){(1===t?v:d)(this.V,i)}}]),i}(),C=function(){function i(n,e,s){t(this,i),this.frame=e,this.imports=s,this.F=!1,this.ht=!1,this.wt=!1,this.Mt=!1,this.xt=_,this.At=_,"string"!=typeof n?(this.V=n,this.O=this.V.innerHTML,this.F=!0,this.Et()):this.O=n}return n(i,[{key:"set",value:function(t,i){this[t]=i,this.Mt=!0}},{key:"mount",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.jt((function(){t.F?t.Mt&&t.update():(t.Tt(),t.F=!0,t.Et(),(i?d:v)(t.frame,t.V))}))}},{key:"unmount",value:function(){var t=this;this.F=!1,this.jt((function(){l(t.V)}))}},{key:"clone",value:function(){var t=new i(this.O,this.frame,this.imports);return t.wt=!0,t}},{key:"translate",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.easing,e=i.done;this.xt=e||_,n?(this.St=!0,this.V.style.transition="transform ".concat(this.imports._.m.speed,"ms ").concat(this.imports._.m.easing)):this.V.style.transition="",this.V.style.transform="translate3d(calc(".concat(this.position,"% + ").concat(t,"), 0, 0)")}},{key:"render",value:function(){return this.V=f("div",{S:"virchual__slide",O:this.O}),this._t(),this.V}},{key:"bindEvents",value:function(){var t=this;this.V.addEventListener("transitionend",(function(){t.St=!1,t.V.style.transition="",t.At(),t.xt()})),this.imports.A.M("move",(function(){t.St=!1}))}},{key:"update",value:function(){this.Mt=!1,this._t()}},{key:"setAttributes",value:function(){y(this.V,"virchual__slide--active",!this.ht),this.V.setAttribute("data-idx",this.Ot+""),this.translate("0%")}},{key:"doAfterTranslating",value:function(t){var i=this;this.St?this.At=function(){t(),i.At=_}:t()}}]),i}();function R(t,i){return i.find((function(i){return i.Ot===t}))}return function(i){!function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,s:!0,i:!0}}),i&&s(t,i)}(h,i);var n,r,o=(n=h,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,i=e(n);if(r){var s=e(this).constructor;t=Reflect.construct(i,arguments,s)}else t=i.apply(this,arguments);return u(this,t)});function h(i){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(this,h),(n=o.call(this,i,e)).register(c,{isEnabled:!0}),n.register(O,{D:!0}),n}return h}(function(){function i(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,i),this.g=n,this.m=e,this.q=0,this.slides=[],this.zt=[],this.Dt=!1,this.frame=this.g.querySelector(".virchual__frame"),k(this.frame,"Invalid element"),this.q=0,this.m=Object.assign({slides:[],speed:200,It:150,Bt:.6,Ct:600,easing:"ease-out",Rt:!0,window:1},e),this.A=new a,this.H={T:this.T.bind(this),Lt:this.Lt.bind(this),Nt:this.Nt.bind(this)};var s=this.Pt(),u=this.Ut();this.slides=[].concat(r(s),r(u));var o=this.qt();this.slides=[].concat(r(this.slides),r(o)),this.m.window=Math.min(this.m.window,Math.max(this.Ft()-1,0)),this.Rt=new B(this.g,this.Ft(),{ht:this.m.Rt}),this.Rt.Tt()}return n(i,[{key:"getSlides",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this.slides:this.slides.filter((function(t){return!t.wt}))}},{key:"getSlidesLength",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.U(t).length}},{key:"register",value:function(t,i){new t({_:this,A:this.A},i)}},{key:"mount",value:function(){this.Ft()<2||(this.Vt(),this.Et(),new z(this.frame,{event:this.A}).mount(),this.A.it("mounted"))}},{key:"disable",value:function(){}},{key:"enable",value:function(){}},{key:"on",value:function(t,i){this.A.M(t,i)}},{key:"off",value:function(t){this.A.$(t)}},{key:"prev",value:function(){this.et("prev")}},{key:"next",value:function(){this.et("next")}},{key:"destroy",value:function(){this.A.destroy(),this.A.it("destroy")}},{key:"goTo",value:function(t){var i=this,n="prev"===t?-1:1,e=this.q+1*n,s=m(e,this.Ft()-1),u=s!==e,r="".concat(-100*n,"%"),o=function(){i.Dt=!1,i.q=s,i.Vt({control:t}),("prev"===t?i.Rt.prev.bind(i.Rt):i.Rt.next.bind(i.Rt))(),i.A.it("move",{index:i.q,control:t})};u?this.move(r,n,{Xt:o}):(this.move(r,n),o())}},{key:"initSlides",value:function(){var t=this,i=this.m.slides;return(("function"==typeof i?i():i)||[]).map((function(i){return new C(i,t.frame,{_:t,A:t.A})}))}},{key:"hydrate",value:function(){var t=this;return[].slice.call(this.frame.children).map((function(i){return new C(i,t.frame,{_:t,A:t.A})}))}},{key:"createClones",value:function(){var t=this.Ft(),i=[];if(t>=2*this.m.window+1)return i;for(var n=t-1;n>=t-this.m.window;n--){var e=this.slides[n].clone();i.push(e)}return i}},{key:"mountAndUnmountSlides",value:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=i.control,e=this.m.window,s=p(0,this.Ft()-1),u=p(0,this.Ft(!0)-1),r=M(u,this.q,e),o=M(s,this.q,e),h=this.$t(r,this.zt);h.forEach((function(i){var e=i.slideIndex,s=o[i.index],u=e===t.q,r=R(e,t.slides)||t.slides[e];if("mount"===i.Gt.type){var h="prev"===n||i.Gt.Ht<0;null==r&&(r=t.slides[s].clone(),t.slides.splice(e,0,r)),r.Ot=e,r.set("isActive",u),r.set("position",100*i.Gt.Ht),r.mount(h)}else r.unmount(),r.wt&&t.slides.splice(e,1)})),this.zt=r}},{key:"diff",value:function(t,i){return i=i||[],[].concat(r(this.Jt(i,t,(function(t,i){if(!t)return i.Gt.type="unmount",i}))),r(this.Jt(t,[])))}},{key:"calculateDiff",value:function(t,i,n){var e=[];return t.forEach((function(s,u){var r={index:u,slideIndex:s,Gt:{type:"mount",Ht:u-Math.floor(t.length/2)}},o=i[u-1]-s,h=i[u+1]-s;(r=null!=n?n(0===o||0===h,r):r)&&e.push(r)})),e}},{key:"bindEvents",value:function(){this.A.M("drag",this.H.Lt),this.A.M("dragend",this.H.Nt),this.A.M("click",this.H.T,this.frame,{capture:!0})}},{key:"onClick",value:function(t){this.Dt&&h(t)}},{key:"onDrag",value:function(t){this.Dt=!0;var i="prev"===t.control?-1:1,n=-1*i*Math.abs(t.offset.x);this.move("".concat(Math.round(n),"px"),i,{easing:!1})}},{key:"move",value:function(t,i){var n=this,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=e.easing,u=e.Xt,r=M(p(0,this.Ft(!0)-1),this.q,this.m.window);(r=i>0?r.slice(-1*(this.m.window+1)):r.slice(0,this.m.window+1)).forEach((function(i){n.slides[i].translate(t,{easing:null==s||s,done:function(){u&&(u(),u=null)}})}))}},{key:"onDragEnd",value:function(t){this.et(t.control)}}]),i}())}));
//# sourceMappingURL=virchual.bundle.min.js.map
