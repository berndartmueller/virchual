!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Virchual=i()}(this,function(){var t,i,n,s,h,u,o,r,e,c;function a(){return(a=Object.assign||function(t){var i,n,s;for(i=1;i<arguments.length;i++)for(s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)}function f(t){t&&(t.cancelable&&t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation())}function v(t,i){var n=i.classNames,s=i.html,h=document.createElement(t);return h.className=n,h.innerHTML=s||"",h}function l(t){t&&t.parentElement&&t.parentElement.removeChild(t)}function d(t,i){t&&t.appendChild(i)}function p(t,i){t&&t.firstChild&&i&&t.insertBefore(i,t.firstChild)}function g(t,i,n){void 0===n&&(n=!1),n?t.classList.remove(i):t.classList.add(i)}function m(t,i){return Array(i-t+1).fill(0).map(function(i,n){return t+n})}function _(t,i){return t>i?0:t<0?i:t}function y(t,i,n){var s,h,u;return t.length<2?t:(s=m(i-n,i-1).map(function(i){return M(t,i)}),h=[t[i]],u=m(i+1,i+n).map(function(i){return M(t,i)}),[].concat(s,h,u))}function M(t,i){var n,s,h,u;if(0!==t.length)return n=i>t.length-1,s=i<0||n,h=n?-1:1,u=Math.max(Math.floor(Math.abs(i)/t.length),1),s&&(i+=h*u*t.length),t[i]}function x(t){return t&&"picture"===t.nodeName.toLowerCase()}function w(t){var i=t.parentNode;return x(i)?i:t}function b(t,i,n,s){return 0===t?t!==i:!(t!==n-1)&&i+1<s}function z(t,i,n){return i-n+t}return t=function(){function t(){this.t=[]}var i=t.prototype;return i.on=function(t,i,n,s){var h,u=this;if(void 0===s&&(s={}),"string"==typeof t)t.split(" ").forEach(function(t){return u.i(t,n,i,s)});else for(h in t)this.i(h,i,t[h],s);return this},i.off=function(t,i,n){var s,h=this;if("string"==typeof t)t.split(" ").forEach(function(t){return h.s(t,n,i)});else for(s in t)this.s(s,i,t[s]);return this},i.emit=function(t){var i=arguments;this.t.forEach(function(n){n.elm||n.event.split(".")[0]!==t||n.handler.apply(n,[].slice.call(i,1))})},i.destroy=function(){this.t.forEach(this.h),this.t=[]},i.h=function(t){t.elm&&t.elm.removeEventListener(t.event,t.handler,t.opts)},i.i=function(t,i,n,s){i&&i.addEventListener(t,n,s),this.t.push({event:t,handler:n,elm:i,opts:s})},i.s=function(t,i,n){var s=this;this.t=this.t.filter(function(h){return!h||h.event!==t||h.handler!==n||h.elm!==i||(s.h(h),!1)})},t}(),i=function(){function t(t,i){var n=this;this.u=t,this.o=i,this.v=function(t){f(t),"prev"!==t.target.closest("button").dataset.controls?n.u.virchual.next():n.u.virchual.prev()},this.l=[].slice.call(t.virchual.container.querySelectorAll(".virchual__control")),this.mount()}return t.prototype.mount=function(){var t=this;this.l.forEach(function(i){return t.u.eventBus.on("click",t.v,i)})},t}(),n=function(){},s="virchual__lazy"+"--loading","virchual__lazy--failed","virchual__lazy--loaded",h=function(){function t(t,i){var n,s,h=this;this.u=t,this.p=function(t){h.g(t.target)},this.m=function(t){var i=t.target;w(i).classList.add("virchual__lazy--failed"),h.g(i)},s=(n=a({lazyload:!0,lazyloadSelector:"img,picture"},i)).lazyloadSelector,this._=n.lazyload,this.M=s,this._&&t.eventBus.on({mounted:function(){h.A()},move:function(){h.A()}})}var i=t.prototype;return i.A=function(){var t=this;this.B().forEach(function(i){return t.k(i)})},i.B=function(){var t=this,i=y(m(0,this.u.virchual.getSlides(!0).length-1),this.u.virchual.currentIndex,1),n=[];return i.forEach(function(i){var s=t.u.virchual.getSlides(!0)[i];s.isMounted&&[].forEach.call(s.ref.querySelectorAll(t.M),function(t){x(t.parentElement)||n.push(t)})}),n},i.k=function(t){var i=this,n=!1;[].forEach.call(t.querySelectorAll("img,source"),function(t){var s=t.dataset.srcset,h=t.dataset.src;s&&(t.setAttribute("srcset",s),t.removeAttribute("data-srcset")),h&&(t.setAttribute("src",t.dataset.src),t.removeAttribute("data-src"),i.u.eventBus.on(i.j(),t)),(s||h)&&(n=!0)}),n&&(t.classList.add("virchual__lazy"),t.classList.add(s))},i.j=function(){return{load:this.p,error:this.m}},i.g=function(t){var i=w(t);i.classList.remove(s),i.classList.add("virchual__lazy--loaded"),this.u.eventBus.off(this.j(),t)},t}(),u=function(){function t(t,i){var n=this,s=i.event;this.I=t,this.N=!1,this.O=function(t){n.N||(n.D=n.T(t,{}),n.P=n.D,n.S.emit("dragstart",n.P))},this.V=function(t){n.D&&(n.P=n.T(t,n.D),n.N?(f(t),n.S.emit("drag",n.P)):n.X(n.P)&&(n.S.emit("drag",n.P),n.N=!0))},this.q=function(){n.D=null,n.N&&(n.C(n.P),n.N=!1)},this.S=s}var i=t.prototype;return i.mount=function(){this.S.on("touchstart mousedown",this.O,this.I,{passive:!0}),this.S.on("touchmove mousemove",this.V,this.I,{passive:!1}),this.S.on("touchend touchcancel mouseleave mouseup dragend",this.q,this.I)},i.X=function(t){var i=t.offset;return 180*Math.atan(Math.abs(i.y)/Math.abs(i.x))/Math.PI<45},i.C=function(t){Math.abs(t.velocity.x)>0&&this.S.emit("dragend",this.P)},i.T=function(t,i){var n=t.timeStamp,s=t.touches,h=s?s[0]:t,u=h.clientX,o=h.clientY,r=i.to||{},e=r.x,c=r.y,a={x:u-(void 0===e?u:e),y:o-(void 0===c?o:c)},f=n-(i.time||0),v={x:a.x/f,y:a.y/f};return{offset:a,velocity:v,to:{x:u,y:o},time:n,control:v.x<0?"next":"prev"}},t}(),r={slide:o="virchual"+"__slide",slideActive:o+"--active",pagination:"virchual__pagination",paginationBullet:"virchual__pagination-bullet",paginationBulletActive:"virchual__pagination-bullet--active",paginationBulletEdge:"virchual__pagination-bullet--edge"},e=function(){function t(t,i,n){var s=void 0===n?{}:n,h=s.diameter,u=s.bullets,o=s.isActive;this.F=t,this.G=i,this.H=0,this.J=!0,this.K=t.querySelector("."+r.pagination),this.L=Math.min(i,null!=u?u:5),this.R=null!=h?h:16,this.J=null==o||o,this.U=Math.floor(this.L/2)}var i=t.prototype;return i.render=function(){var t=this;!this.J||this.G<2?this.J=!1:(this.K=v("div",{classNames:r.pagination}),this.K.style.width=this.L*this.R+"px",this.K.style.height=this.R+"px",m(0,Math.min(this.L,this.G)-1).forEach(function(i){var n=b(i,i,t.L,t.G),s=t.W(i,{isEdge:n,isActive:i===t.H});d(t.K,s)}),d(this.F,this.K))},i.next=function(){this.C(1)},i.prev=function(){this.C(-1)},i.C=function(t){var i,n,s,h,u,o,r,e,c,a=this;this.J&&(this.H=_(this.H+t,this.G-1),r=this.H,e=this.U,i=this.L>=(c=this.G)?r:r-Math.max(r-e,0)+Math.max(r-(-1+c-e),0),s=-1,(n=i===this.U&&(t>0?this.H-this.U>0:this.H+this.U+(t>0?0:1)<this.G))&&(s=1===t?0:this.L-1),[].slice.call(this.K.querySelectorAll("span")).forEach(function(h,u){a.Y({bullet:h,index:u,sign:t,removeBullet:n,removeBulletIndex:s,activeIndex:i})}),n&&(u=b(h=-1+this.L-s,z(h,this.H,i),this.L,this.G),o=this.W(h,{isEdge:u}),this.Z(t,o)))},i.Y=function(t){var i,n=t.bullet,s=t.index,h=t.activeIndex,u=t.removeBullet;t.removeBulletIndex!==s?(i=b(s-=u?t.sign:0,z(s,this.H,h),this.L,this.G),this.$(n,{isEdge:i,isActive:s===h,position:u?s*this.R:void 0})):l(n)},i.W=function(t,i){var n=void 0===i?{}:i,s=n.isActive,h=n.isEdge,u=v("span",{classNames:r.paginationBullet});return this.$(u,{isActive:s,isEdge:h,position:t*this.R}),u},i.$=function(t,i){var n=i.isEdge,s=i.position;g(t,r.paginationBulletActive,!i.isActive),g(t,r.paginationBulletEdge,!n),null!=s&&(t.style.transform="translateX("+s+"px)")},i.Z=function(t,i){(1===t?d:p)(this.K,i)},t}(),c=function(){function t(t,i,s){var h=this;this.I=i,this.u=s,this.isMounted=!1,this.isActive=!1,this.isClone=!1,this.tt=!1,this.it=!0,this.nt=n,this.st=n,this.ht=function(){h.ref.style.transition="",h.st(),h.nt(),h.ut()},this.V=function(){h.ut()},"string"!=typeof t?(this.ref=t,this.ot=this.ref.innerHTML,this.isMounted=!0,this.rt()):this.ot=t}var i=t.prototype;return i.set=function(t,i){this[t]=i,this.tt=!0},i.mount=function(t){var i=this;void 0===t&&(t=!1),this.et(function(){i.isMounted?i.tt&&i.ct():(i.at(),i.isMounted=!0,i.rt(),(t?p:d)(i.I,i.ref))})},i.unmount=function(){var t=this;this.isMounted=!1,this.et(function(){t.ft(),l(t.ref)})},i.clone=function(){var i=new t(this.ot,this.I,this.u);return i.isClone=!0,i},i.translate=function(t,i){var s,h=void 0===i?{}:i,u=h.easing;this.nt=h.done||n,this.it=!0!==u,s="",u&&(s="transform "+this.u.virchual.settings.speed+"ms "+this.u.virchual.settings.easing),this.ref.style.transition=s,this.ref.style.transform="translate3d(calc("+this.position+"% + "+t+"), 0, 0)"},i.at=function(){return this.ref=v("div",{classNames:r.slide,html:this.ot}),this.$(),this.ref},i.rt=function(){this.u.eventBus.on("transitionend",this.ht,this.ref),this.u.eventBus.on("move",this.V)},i.ft=function(){this.u.eventBus.off("transitionend",this.ht,this.ref),this.u.eventBus.off("move",this.V)},i.ct=function(){this.tt=!1,this.$()},i.$=function(){g(this.ref,r.slideActive,!this.isActive),this.translate("0%")},i.et=function(t){var i=this;this.it?t():this.st=function(){t(),i.ut()}},i.ut=function(){this.st=n,this.it=!0},t}(),function(t){var n,s;function u(n,s){var u;return void 0===s&&(s={}),(u=t.call(this,n,s)||this).register(i,{isEnabled:!0}),u.register(h,{lazyload:!0}),u}return s=t,(n=u).prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s,u}(function(){function i(i,n){var s,h,u,o=this;void 0===n&&(n={}),this.container=i,this.settings=n,this.currentIndex=0,this.vt=[],this.lt=[],this.dt=!1,this.pt=!0,this.v=function(t){o.dt&&f(t)},this.gt=function(t){var i,n;o.pt&&(o.dt=!0,n=-1*(i="prev"===t.control?-1:1)*Math.abs(t.offset.x),o._t(Math.round(n)+"px",i,{easing:!1}))},this.yt=function(t){o.C(t.control)},this.frame=this.container.querySelector(".virchual__frame"),function(t){if(!t)throw new Error("Invalid element")}(this.frame),this.currentIndex=0,this.settings=a({slides:[],speed:200,swipeDistanceThreshold:150,flickVelocityThreshold:.6,flickPower:600,easing:"ease-out",pagination:!0,window:1},n),this.S=new t,s=this.Mt(),h=this.xt(),this.vt=[].concat(s,h),u=this.wt(),this.vt=[].concat(this.vt,u),this.settings.window=Math.min(this.settings.window,Math.max(this.getSlidesLength()-1,0)),this.bt=new e(this.container,this.getSlidesLength(),{isActive:this.settings.pagination}),this.bt.render()}var n=i.prototype;return n.getSlides=function(t){return void 0===t&&(t=!1),t?this.vt:this.vt.filter(function(t){return!t.isClone})},n.getSlidesLength=function(t){return void 0===t&&(t=!1),this.getSlides(t).length},n.register=function(t,i){new t({virchual:this,eventBus:this.S},i)},n.mount=function(){this.getSlidesLength()<2||(this.zt(),this.rt(),new u(this.frame,{event:this.S}).mount(),this.S.emit("mounted"))},n.disable=function(){this.pt=!1},n.enable=function(){this.pt=!1},n.on=function(t,i){this.S.on(t,i)},n.off=function(t,i){this.S.off(t,i)},n.prev=function(){this.C("prev")},n.next=function(){this.C("next")},n.destroy=function(){this.S.destroy(),this.S.emit("destroy")},n.C=function(t){var i,n,s,h,u,o=this;this.pt&&(h=-100*(i="prev"===t?-1:1)+"%",u=function(){o.dt=!1,o.currentIndex=s,o.zt({control:t}),("prev"===t?o.bt.prev.bind(o.bt):o.bt.next.bind(o.bt))(),o.S.emit("move",{index:o.currentIndex,control:t})},(s=_(n=this.currentIndex+1*i,this.getSlidesLength()-1))!==n?this._t(h,i,{callback:u}):(this._t(h,i),u()))},n.xt=function(){var t=this,i=this.settings.slides;return(("function"==typeof i?i():i)||[]).map(function(i){return new c(i,t.frame,{virchual:t,eventBus:t.S})})},n.Mt=function(){var t=this;return[].slice.call(this.frame.children).map(function(i){return new c(i,t.frame,{virchual:t,eventBus:t.S})})},n.wt=function(){var t,i,n=this.getSlidesLength(),s=[];if(n>=2*this.settings.window+1)return s;for(t=n-1;t>=n-this.settings.window;t--)i=this.vt[t].clone(),s.push(i);return s},n.zt=function(t){var i=this,n=(void 0===t?{}:t).control,s=this.settings.window,h=m(0,this.getSlidesLength()-1),u=y(m(0,this.getSlidesLength(!0)-1),this.currentIndex,s),o=y(h,this.currentIndex,s);this.At(u,this.lt).forEach(function(t){var s,h,u=t.slideIndex,r=o[t.index],e=u===i.currentIndex,c=(h=u,i.vt.find(function(t){return t.idx===h})||i.vt[u]);"mount"===t.action.type?(s="prev"===n||t.action.centerDistance<0,null==c&&(c=i.vt[r].clone(),i.vt.splice(u,0,c)),c.idx=u,c.set("isActive",e),c.set("position",100*t.action.centerDistance),c.mount(s)):(c.unmount(),c.isClone&&i.vt.splice(u,1))}),this.lt=u},n.At=function(t,i){return[].concat(this.Bt(i=i||[],t,function(t,i){if(!t)return i.action.type="unmount",i}),this.Bt(t,[]))},n.Bt=function(t,i,n){var s=[];return t.forEach(function(h,u){var o={index:u,slideIndex:h,action:{type:"mount",centerDistance:u-Math.floor(t.length/2)}};(o=null!=n?n(0===i[u-1]-h||0===i[u+1]-h,o):o)&&s.push(o)}),s},n.rt=function(){this.S.on("drag",this.gt),this.S.on("dragend",this.yt),this.S.on("click",this.v,this.frame,{capture:!0})},n._t=function(t,i,n){var s=this,h=void 0===n?{}:n,u=h.easing,o=h.callback,r=y(m(0,this.getSlidesLength(!0)-1),this.currentIndex,this.settings.window);(r=i>0?r.slice(-1*(this.settings.window+1)):r.slice(0,this.settings.window+1)).forEach(function(i){s.vt[i].translate(t,{easing:null==u||u,done:function(){o&&(o(),o=null)}})})},i}())});
//# sourceMappingURL=virchual.umd.js.map
